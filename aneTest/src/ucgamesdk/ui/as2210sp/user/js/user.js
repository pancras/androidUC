S.SSCL.LoginHist=Backbone.Collection.extend({initialize:function(){_.bindAll(this)},getHistory:function(a){var b=a.success?a.success:null,c=a.error?a.error:null,a=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.GET_LOGIN_GAMEHISTORYSYNC,a.data);a.success?(this.reset(a.data),b.apply(this,[this,a])):(this.reset([]),c.apply(this,[this,a]))},getServerHistory:function(a){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.QUERY_HISTORY;this.fetch(a)},
parse:function(a){return a}});S.SSCL.QuestionList=Backbone.Collection.extend({initialize:function(){_.bindAll(this)},getQuestionList:function(a){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.GET_QUESTION_HISTORY;this.fetch(a)},parse:function(a){return a}});S.SSCT.AccountManage=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},getSecureState:function(a){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy");this.secureModel.getSecureState({success:function(b,c){console.log("getSecureState success : "+JSON.stringify(c));a.success(c.data)},error:function(b,c){console.log("getSecureState error : "+JSON.stringify(c));a.error(c.msg)},quiet:!0})},sendCode2Mobile:function(a,b){this.secureModel=this.secureModel?
this.secureModel:S.SSCT.GetHandler("Model","Secrecy");this.secureModel.sendCodeToMobile({data:a,success:function(a,b){console.log("sendCodeToMobile success : "+JSON.stringify(b))},error:function(a,d){console.log("sendCodeToMobile error : "+JSON.stringify(d));b.error(d.msg)},quiet:!0})},doBindMobile:function(a,b){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy");this.secureModel.bindMobile({data:a,success:function(a,d){console.log("bindMobile success : "+JSON.stringify(d));
b.success()},error:function(a,d){console.log("bindMobile error : "+JSON.stringify(d));b.error(d)},quiet:!0})},checkIsBinded:function(a,b){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy");this.secureModel.checkIsBinded({data:a,success:function(a,d){console.log("checkIsBinded success : "+JSON.stringify(d));b.success(d.data)},error:function(a,d){console.log("checkIsBinded error : "+JSON.stringify(d));b.error(d.msg)},quiet:!0})},doSaveSecurityQuestions:function(a,
b){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy");this.secureModel.saveSecurityQuestions({data:a,success:function(a,d){console.log("saveSecurityQuestions success : "+JSON.stringify(d));b.success()},error:function(a,d){console.log("saveSecurityQuestions error : "+JSON.stringify(d));b.error(d)},quiet:!0})}});S.SSCT.Secrecy=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},sendMsgToMobile:function(a,b){var c=S.SSCT.GetHandler("Model","Secrecy");c.changeUrl("sendMsgToMobile");c.fetch({data:a,success:function(){S.SSCT.GetHandler("Controller","General").setCacheData("phone",a.phone,1800,!0);b.success()},error:function(a,c){b.error(c.msg)},quiet:!0})},doBindMobile:function(a,b){var c=S.SSCT.GetHandler("Model","Secrecy");c.changeUrl("bindMobile");c.fetch({data:a,success:function(){b.success()},
error:function(a,c){b.error(c.msg)},quiet:!0})}});S.SSCT.Sso=Backbone.Controller.extend({initialize:function(){},CONFIG:{ACCOUNT_TYPE:{LOGIN:0,GAME_LOGIN:1}},histLength:{},serverHistLength:{},getHistLength:function(a){return this.histLength[a]?this.histLength[a]:0},loginConfig:null,getLoginConfig:function(){this.loginConfig||this.getLoginData(this.callBackMix(function(a){this.loginConfig=a}));return this.loginConfig},histories:{},getHistories:function(a){return this.histories[a]?this.histories[a]:void 0},setHistories:function(a,b){this.histories[a]=
b},serverHistories:{},getServerHistories:function(a){return this.serverHistories[a]?this.serverHistories[a]:void 0},validLoginData:function(a,b,c,d){d=d?d:{};d.error=d.error?d.error:function(){};d.success=d.success?d.success:function(){};if(0===b.length||0===a.length)d.error("\u8d26\u53f7\u6216\u5bc6\u7801\u8f93\u5165\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");else{if(c===this.CONFIG.ACCOUNT_TYPE.LOGIN){if(2>a.length||20<a.length){d.error("\u8d26\u53f7\u6216\u5bc6\u7801\u8f93\u5165\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");
return}if(!rConfig.user.accountFilter.test(a)&&!rConfig.user.emailAccountFilter.test(a)){d.error("\u8d26\u53f7\u6216\u5bc6\u7801\u8f93\u5165\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");return}if(6>b.length||20<b.length){d.error("\u8d26\u53f7\u6216\u5bc6\u7801\u8f93\u5165\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");return}}d.success(a,b)}},loginSubmit:function(a,b,c){c=c?c:{};c.error=c.error?c.error:function(){};c.success=c.success?c.success:function(){};var d=S.SSCT.GetHandler("Model",
"Sso");d.on("error",_.bind(function(a,b){c.error(a,{msg:b});d.off("error")},this));var e=_.isUndefined(a.accountType)?0:a.accountType,f=_.isUndefined(a.rememberPassword)?!0:a.rememberPassword;a.accountType=e;a.rememberPassword=f;d.set(a)&&d.login({success:function(a,b){S.SSCT.GetHandler("Controller","User").getCurUserInfo();c.success(a,b)},error:function(a,b){c.error(a,b)},data:a,quiet:b})},getLoginData:function(a){var b=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.GET_LOGIN_CONFIG);
!_.isUndefined(b)&&b.success?(this.loginConfig=b.data,a.success(b.data)):a.error(b?b.msg:"\u83b7\u53d6\u767b\u5f55\u914d\u7f6e\u5931\u8d25")},getHistory:function(a,b,c){var c=!_.isUndefined(c)?c:!1,b=b?b:{},d=this;S.SSCT.GetHandler("Collection","LoginHist").getHistory({success:function(c,f){d.histories[a]=f.data;d.histLength[a]=f.data.length?f.data.length:0;a===d.CONFIG.ACCOUNT_TYPE.LOGIN&&_.each(f.data,function(a){var b=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+a.account,
!0);if(b)a.isRandomPassword=b.random});b.success&&b.success(f.data)},error:function(a,c){b.error&&b.error(c.msg)},data:{accountType:a},quiet:c})},getServerHistory:function(a,b){var b=b?b:{},c=S.SSCT.GetHandler("Collection","LoginHist"),d=this;d.serverHistories[a]?b.success&&b.success(d.serverHistories[a]):c.getServerHistory({success:function(c,f){var g=f.data.uids;d.serverHistories[a]=g;d.serverHistLength[a]=g.length?g.length:0;a===d.CONFIG.ACCOUNT_TYPE.LOGIN&&_.each(g,function(a){var b=S.SSCT.GetHandler("Controller",
"General").getCacheData("user_info_"+a.account,!0);if(b)a.isRandomPassword=b.random});b.success&&b.success(g)},error:function(a,c){b.error&&b.error(c.msg)},data:{accountType:a},quiet:!0})},getHistByUsername:function(a,b,c){var d=null,b=this.histories[b];!_.isUndefined(a)&&!_.isUndefined(b)&&_.each(b,function(b){b.account==a&&(d=b)});d?c.success&&c.success(d):c.error&&c.error("\u627e\u4e0d\u5230\u5339\u914d\u7684\u7528\u6237\u8d26\u53f7")},clearHistFlag:function(a){var a=a?a:{},b=sdk.PageCache.get("clear_history");
b.success&&1===b.data?(S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.CLEAR_HISTORY),sdk.PageCache.del("clear_history"),a.success&&a.success()):a.error&&a.error()},getLoginCount:function(a){return(ucf.Cache.get("login_count_info",!0)||{})[a]||0},updateLoginCount:function(a){var b=ucf.Cache.get("login_count_info",!0)||{};console.log(JSON.stringify(b));var c=b[a]||0;10>c&&c++;b[a]=c;ucf.Cache.set("login_count_info",b,0,!0)},validSecrecy:function(a,b,c){a=S.SSCT.GetHandler("Controller","AccountManage");
a.getSecureState(a.callBackMix(function(a){3<=a.risk?c.success(a):c.error&&c.error("safe")},function(){c.error&&c.error("fail")}))}});S.SSCT.User=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},curUser:{},userName:"",getCurUser:function(){return this.curUser},setCurUser:function(a){this.curUser=a},getCurUserInfo:function(a){var b=S.sdkBase.request(S.sdkBase.servType.COMMON,S.sdkBase.actions.GET_CURR_USER);b.success?(this.curUser=b.data,a&&a.success&&a.success.apply(this,[b.data])):a&&a.error&&a.error.apply(this,[b.msg])},getBaseUserInfo:function(a,b){var a=a?a:{},c=ucf.Cache.get("userBaseInfo_"+this.curUser.ucid,
!0);if(_.isUndefined(c)||_.isEmpty(c)){var d=S.SSCT.GetHandler("Model","User"),b=!_.isUndefined(b)?b:!1;d.fetchBaseUserInfo({data:{uid:this.curUser.ucid},success:$.proxy(function(b){c=b.toJSON();ucf.Cache.set("userBaseInfo_"+this.curUser.ucid,c,1800,!0);a.success&&a.success.apply(this,[c])},this),error:$.proxy(function(b,c){a.error&&a.error.apply(this,[c.msg])},this),quiet:b})}else a.success&&a.success.apply(this,[c])},updatePass:function(a,b){var c=b.success?b.success:function(){},d=b.error?b.error:
function(){},e=S.SSCT.GetHandler("Model","User");e.off("error");e.on("error",$.proxy(function(a,b){d.apply(this,[b])},this));e.set(a)&&e.updatePass({success:$.proxy(function(){this.getCurUserInfo(this.callBackMix(function(a){var b=ucf.Cache.get("user_info_"+a.ucid,!0);b&&b.random&&ucf.Cache.remove("user_info_"+a.ucid,!0)}));c()},this),error:$.proxy(function(a,b){d.apply(this,[b.msg])},this),data:a})},registerUpdatePass:function(a,b){var c=b.success?b.success:function(){},d=b.error?b.error:function(){},
e=S.SSCT.GetHandler("Model","User");e.off("error");e.on("error",$.proxy(function(a,b){d.apply(this,[b])},this));var f=this;e.set(a)&&e.updatePass({success:$.proxy(function(){f.getCurUserInfo(f.callBackMix(function(b){f.setRegData(b.ucid,a.password);ucf.Cache.set("user_info_"+b.ucid,{random:!1,password:a.password},0,!0)}));c()},this),error:$.proxy(function(a,b){d.apply(this,[b.msg])},this),data:a})},register:function(a,b,c){var b=b?b:{},c=!_.isUndefined(c)?c:!1,d=S.SSCT.GetHandler("Model","Register");
d.off("error");d.on("error",function(a,c){b.error(c)});d.set(a)&&d.register({data:a,success:$.proxy(function(a,c){this.setRegData(a.get("ucid"),a.get("password"));S.SSCT.GetHandler("Controller","General").setCacheData("regUcid",a.get("ucid"),1800,!0);b.success(a,c)},this),error:function(a,c){b.error(c.msg)},quiet:c})},sdkExit:function(){S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGIN_EXIT_SDK)},getVipInfo:function(a,b){var c=S.SSCT.GetHandler("Model","Vip"),d=this,e=ucf.Cache.get("vipInfo"+
this.curUser.ucid,!0);_.isUndefined(e)?(b=!_.isUndefined(b)?b:!1,c.fetchVipInfo({success:function(b,c){ucf.Cache.set("vipInfo"+d.curUser.ucid,c.data,86400,!0);"1"==c.data.privilegeStatus&&"1"==c.data.vipStatus?a.success&&a.success():a.error&&a.error("no vip privilege")},error:function(){ucf.Cache.set("vipInfo"+d.curUser.ucid,{privilegeStatus:"0",vipStatus:"0"},1800,!0);a.error&&a.error("privilegeStatus or vipStatus exception!!")},data:{uid:d.curUser.ucid,privilegeCode:"0001",timestamp:Math.round((new Date).getTime()/
1E3)},quiet:b})):"1"==e.privilegeStatus&&"1"==e.vipStatus?a.success&&a.success():a.error&&a.error("no vip privilege")},notifyCp:function(a,b,c){c=!_.isUndefined(c)&&!_.isEmpty(c)?c:"login";switch(c){case "login":var d=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGIN_NOTIFY_CP,{code:a.code,msg:a.msg});break;case "logout":d=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT_NOTIFY_CP)}d.success?b&&b.success&&b.success.apply(this):b&&b.error&&b.error.apply(this)},setRegData:function(a,
b){sdk.PageCache.set("regInfo",JSON.stringify({ucid:a,password:b}))},getRegData:function(a){var b=sdk.PageCache.get("regInfo");a&&(b.success?a.success&&!_.isEmpty(b.data)?a.success(JSON.parse(b.data)):a.error():a.error&&a.error())},getFeatureSwitch:function(a){var b=a&&a.success?a.success:function(){},a=a&&a.error?a.error:function(){},c=S.sdkBase.request(S.sdkBase.servType.COMMON,S.sdkBase.actions.GET_FEATURE_SWITCH);c.success?b.apply(this,[c.data]):a.apply(this,[c])},logout:function(a){var b=a&&
a.success?a.success:function(){},a=a&&a.error?a.error:function(){};S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT).success?(this.notifyCp(null,null,"logout"),b.apply()):a.apply()},setNerverNotice:function(a,b,c){var d=ucf.Cache.get("nerver_notice_info",!0)||{},c=!_.isUndefined(c)?c:"existAccount";d[a]=d[a]||{};d[a][c]=b;ucf.Cache.set("nerver_notice_info",d,0,!0)},checkNoticeInfo:function(a,b){var c=ucf.Cache.get("nerver_notice_info",!0)||{},b=!_.isUndefined(b)?b:"existAccount";
c[a]=c[a]||{};return c[a][b]?!0:!1},getSecQuestion:function(a,b){var c=S.SSCT.GetHandler("Model","User");!a||0===a?b.error&&b.error("\u8bf7\u8f93\u5165UC\u8d26\u53f7"):rConfig.user.accountFilter.test(a)?c.getSecQuestion({data:{ucid:parseInt(a)},success:function(a,c){console.log(b);c.data?b.success&&b.success(c.data):b.error&&b.error(c.msg)},error:function(a,c){b.error&&b.error(c.msg)}}):b.error&&b.error("UC\u8d26\u53f7\u5fc5\u987b\u4e3a\u6570\u5b57")},validateAnswer:function(a,b){var c=S.SSCT.GetHandler("Model",
"User");!a.password_answer||0===a.password_answer.length?b.error&&b.error("\u8bf7\u8f93\u5165\u5bc6\u4fdd\u95ee\u9898\u7b54\u6848"):c.validateAnswer({data:a,success:function(a,c){b.success&&b.success(c)},error:function(a,c){b.error&&b.error(c.msg)}})},resetPassword:function(a,b){var c=S.SSCT.GetHandler("Model","User");6>a.password.length||20<a.password.length?b.error&&b.error("\u5bc6\u7801\u957f\u5ea6\u4e0d\u7b26\uff086-20\u4f4d\uff09"):a.password.match(rConfig.user.passwordFilter)?b.error&&b.error("\u5bc6\u7801\u5fc5\u987b\u4e3a\u5b57\u6bcd\u6216\u6570\u5b57"):
c.resetPassword({data:a,success:function(c,e){var f=ucf.Cache.get("user_info_"+a.ucid,!0);f&&f.random&&ucf.Cache.remove("user_info_"+a.ucid,!0);b.success&&b.success(e.data)},error:function(a,c){b.error&&b.error(c.msg)}})},updateNickname:function(a,b){var c=b.success?b.success:function(){},d=b.error?b.error:function(){},e=S.SSCT.GetHandler("Model","User"),f=this;e.off("error");e.on("error",$.proxy(function(a,b){d.apply(this,[b])},this));e.set(a)&&e.updateNickname({success:$.proxy(function(){f.getCurUserInfo();
var b=f.curUser;ucf.Cache.get("userBaseInfo_"+b.ucid,!0)&&(ucf.Cache.remove("userBaseInfo_"+b.ucid,!0),ucf.Cache.get("userBaseInfo_"+b.ucid,!0));this.userName=a.userName;c()},this),error:$.proxy(function(a,b){d.apply(this,[b.msg])},this),data:a})},removeHistory:function(a,b){S.SSCT.GetHandler("Model","User").removeHistory({data:a,success:function(){b.success()},error:function(a,d){b.error&&b.error(d.msg)},quiet:!0})},getLoginHistoryCount:function(a,b){S.SSCT.GetHandler("Model","User").getLoginHistoryCount({data:a,
success:function(a,d){b.success&&b.success(d.data)},error:function(a,d){b.error&&b.error(d.msg)},quiet:!0})}});S.SSCT.Pay=Backbone.Controller.extend({getUPointBalance:function(a){var b=a&&a.success?a.success:function(){},a=a&&a.error?a.error:function(){};S.SSCT.GetHandler("Model","UPoint").fetchUPoint({success:b,error:a,data:null,quiet:!0})}});S.SSMO.Register=Backbone.Model.extend({initialize:function(){_.bindAll(this);this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.REGISTER;this.isRequest=!1},validate:function(a){if(!this.isRequest){if(_.isEmpty(a.password))return"\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165";if(6>a.password.length||20<a.password.length)return"\u5bc6\u7801\u957f\u5ea6\u4e3a6-20\u4f4d";if(a.password.match(rConfig.user.passwordFilter))return"\u5bc6\u7801\u53ea\u80fd\u4e3a\u82f1\u6587\u5b57\u6bcd\u548c\u6570\u5b57\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165";
if(!a.agree)return"\u4e0d\u540c\u610fUC\u8d26\u53f7\u670d\u52a1\u534f\u8bae\u65e0\u6cd5\u6ce8\u518c\u54e6^-^"}this.isRequest=!1},register:function(a){this.fetch(a)},parse:function(a){this.isRequest=!0;return a.data}});S.SSMO.Secrecy=Backbone.Model.extend({initialize:function(){_.bindAll(this)},validate:function(a){console.log(a);null===a.mobile&&alert("not null")},validateMobile:function(a){return null===a.match(rConfig.user.mobileFilter)?{msg:"\u624b\u673a\u53f7\u7801\u5fc5\u987b\u4e3a\u6570\u5b57",success:!1}:11!==a.length||"1"!==a[0]?{msg:"\u624b\u673a\u53f7\u7801\u8f93\u5165\u9519\u8bef",success:!1}:{msg:"success",success:!0}},validateCode:function(a){return null==a||""==a?{msg:"\u9a8c\u8bc1\u7801\u4e0d\u80fd\u4e3a\u7a7a",
success:!1}:{msg:"success",success:!0}},validateQuestions:function(a){return 2>a.length||20<a.length?{msg:"\u5bc6\u4fdd\u95ee\u9898\u957f\u5ea6\u5fc5\u987b\u57282~20\u4f4d\u4e4b\u95f4",success:!1}:{msg:"success",success:!0}},validateQuestionAnswers:function(a){return 2>a.length||20<a.length?{msg:"\u5bc6\u4fdd\u7b54\u6848\u957f\u5ea6\u5fc5\u987b\u57282~20\u4f4d\u4e4b\u95f4",success:!1}:{msg:"success",success:!0}},validatePassword:function(a){return 6>a.length||20<a.length?{msg:"\u5bc6\u7801\u957f\u5ea6\u5fc5\u987b\u57286~20\u4f4d\u4e4b\u95f4",
success:!1}:a.match(rConfig.user.passwordFilter)?{msg:"\u5bc6\u7801\u53ea\u80fd\u4e3a\u82f1\u6587\u5b57\u6bcd\u548c\u6570\u5b57\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165",success:!1}:{msg:"success",success:!0}},parse:function(a){return a.data},getSecureState:function(a){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_QUERYSECURESTATE;this.fetch(a)},sendCodeToMobile:function(a){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+
"/"+rConfig.apis.UCID_ACCOUNT_SENDMOBILESMSCODE;this.fetch(a)},bindMobile:function(a){var b=this.validateCode(a.data.code),c=this.validatePassword(a.data.password);b.success?c.success?(this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_BINDMOBILEBYSMSCODE,this.fetch(a)):a.error(this,c):a.error(this,b)},checkIsBinded:function(a){var b=this.validateMobile(a.data.mobile);b.success?(this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+
"/"+rConfig.apis.UCID_ACCOUNT_CHECKISBINDED,this.fetch(a)):a.error(this,b)},saveSecurityQuestions:function(a){var b=this.validateQuestions(a.data.password_question),c=this.validateQuestionAnswers(a.data.password_answer),d=this.validatePassword(a.data.password);b.success?c.success?d.success?(this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_SETPASSWORDQUESTION,this.fetch(a)):a.error(this,d):a.error(this,c):a.error(this,b)}});S.SSMO.Sso=Backbone.Model.extend({defaults:{rememberPassword:!0},initialize:function(){_.bindAll(this);this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.LOGIN},login:function(a){this.fetch(a)},parse:function(a){this.isRequest=!0;return a.data||a}});S.SSMO.User=Backbone.Model.extend({initialize:function(){_.bindAll(this)},fetchBaseUserInfo:function(a){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.USER_BASEINFO;console.log("do fetch");this.fetch(a)},updatePass:function(a){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.CHANGE_PASSWORD;this.fetch(a)},validate:function(a){if(_.isUndefined(a.isPostDetail)&&!_.isUndefined(a.isPostPass)){if(6>a.password.length||20<a.password.length)return"\u5bc6\u7801\u957f\u5ea6\u4e0d\u7b26\uff086-20\u4f4d\uff09";
if(a.password.match(rConfig.user.passwordFilter))return"\u5bc6\u7801\u5fc5\u987b\u4e3a\u5b57\u6bcd\u6216\u6570\u5b57";if(6>a.oldPassword.length||20<a.oldPassword.length)return"\u5bc6\u7801\u957f\u5ea6\u4e0d\u7b26\uff086-20\u4f4d\uff09";if(a.oldPassword.match(rConfig.user.passwordFilter))return"\u5bc6\u7801\u5fc5\u987b\u4e3a\u5b57\u6bcd\u6216\u6570\u5b57"}},parse:function(a){return a.data},getSecQuestion:function(a){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.SECURITY_QUESTION;
this.fetch(a)},validateAnswer:function(a){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.VALIDATE_ANSWER;this.fetch(a)},resetPassword:function(a){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.RESET_PASSWORD;this.fetch(a)},removeHistory:function(a){var b=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.DELETE_LOGIN_HISTORY,a.data);b.success?a.success.apply(this,[this,b]):(this.reset([]),a.error.apply(this,
[this,b]))},updateNickname:function(a){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UPDATE_NICKNAME;this.fetch(a)},getLoginHistoryCount:function(a){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.GET_LOGIN_HISTORY_COUNT;this.fetch(a)}});S.SSMO.Vip=Backbone.Model.extend({initialize:function(){_.bindAll(this);this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.VIP},fetchVipInfo:function(a){this.fetch(a)},parse:function(a){return a.data}});S.SSMO.UPoint=Backbone.Model.extend({initialize:function(){_.bindAll(this);this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UPOINT_BALANCE},fetchUPoint:function(a){this.fetch(a)},parse:function(a){return a.data}});S.SSVW.FindPassword=Backbone.View.extend({el:"#userContainer",events:{"onclick #validAccountBtn":"validAccount","onclick #secAnswerSubBtn":"secAnswerSubmit","onclick #newPasswordSubBtn":"newPasswordSubmit","onclick #appealSubBtn":"appealSubmit","onclick #needResetPassword":"checkedNeedResetPassword","onclick #messageRetakeBtn":"retakeMethod","onclick #secAnswerRetakeBtn":"retakeMethod","onclick #appealRetakeBtn":"retakeMethod","onclick #toAppealRetakeBtn":"toAppealRetake","onclick #resetPassReturnGameBtn":"returnGame",
"onclick #accountList > .ac-item":"retakeAccount"},local:{defaultTab:"messageRetake",tabs:["messageRetake","secAnswerRetake","appealRetake"]},initialize:function(){_.bindAll(this);this.controller=S.SSCT.GetHandler("Controller","User");this.ssoController=S.SSCT.GetHandler("Controller","Sso");this.generalController=S.SSCT.GetHandler("Controller","General")},secAnswerRetake:function(){},validAccount:function(){var a=$("#ucAccount").val(),b=document.createElement("div");document.body.appendChild(b);var c=
this;this.controller.getSecQuestion(a,this.controller.callBackMix(function(d){document.body.removeChild(b);d.password_question?(sdk.PageCache.set("account_security_question",{account:a,question:d.password_question}),sdk.Url.location.route("#!findPassword/securityAnswer")):c._showErrorMsg("\u83b7\u53d6\u5bc6\u4fdd\u95ee\u9898\u5931\u8d25")},function(a){document.body.removeChild(b);c._showErrorMsg(a)}))},securityAnswer:function(){var a=sdk.PageCache.get("account_security_question");a.success&&a.data&&
($("#question").html(a.data.question),$("#question").attr("data-value",a.data.question),$("#ucAccount").html(a.data.account),$("#ucAccount").attr("data-value",a.data.account))},secAnswerSubmit:function(){var a=$("#securityAnswer").val(),b=$("#question").attr("data-value"),c=$("#ucAccount").attr("data-value"),d=this;this.controller.validateAnswer({ucid:parseInt(c,10),password_question:b,password_answer:a},this.controller.callBackMix(function(){sdk.PageCache.set("account_resetPassword_params",{account:c,
question:b,answer:a});sdk.Url.location.route("#!findPassword/resetPassword/"+c)},function(a){console.log(a);d._showErrorMsg(a)}))},resetPassword:function(a){$("#resetPassAccount").attr("data-value",a);S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0});document.addEventListener("backbutton",function(){S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1})})},newPasswordSubmit:function(){var a=$("#newPassword").val(),b=$("#resetPassAccount").attr("data-value"),
c=sdk.PageCache.get("account_resetPassword_params"),d=this;if(c.success&&c.data)c=c.data,this.controller.resetPassword({ucid:parseInt(b,10),password_question:c.question,password_answer:c.answer,password:a},this.controller.callBackMix(function(){$("#successBox").removeClass("ms-none")},function(a){d._showErrorMsg(a)}))},appealSubmit:function(){var a=$("#server").val(),b=$("#contact").val(),c="checked"===$("#needResetPassword").attr("data-checked")?!0:!1;console.log("server : ["+a+"]  contact : ["+
b+"] reset : ["+c+"]")},appealSuccess:function(){},passwordRetake:function(a){$("#chooseTab").on("click",function(a){$(a.target).css("boxShadow","none")});var b;S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"});S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(a){"backToLogin"==a.action&&(S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),b=!0,S.Url.location.route("#!sso/login"),
S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.CLEAR_HISTORY))}});if(!0!==b){var c=rConfig.ACCOUNT_TYPE.UC;this.showRetakePageByTab(this.tabType||a||this.local.defaultTab);var d=this;this.ssoController.getServerHistory(c,this.ssoController.callBackMix(function(a){var b="";0<a.length?($("#accountList").removeClass("ms-none"),$("#hasAccount").html("\u66fe\u5728\u672c\u673a\u767b\u5f55\u8fc7\u7684UC\u8d26\u53f7\uff1a"),_.each(a,function(a){var c="";a.loginTime&&(c=a.loginTime);b+='<div class="ac-item" data-account='+
a.ucid+" data-password="+a.password+'><em class="em_arrow">&nbsp;</em>UC\u8d26\u53f7\uff1a'+a.ucid+"<br />\u6700\u8fd1\u767b\u5f55\u65f6\u95f4\uff1a"+c+"</div>"}),$("#accountList").html(b)):$("#hasAccount").html("\uff01\u6ca1\u6709\u5728\u672c\u673a\u767b\u5f55\u8fc7UC\u8d26\u53f7")},function(a){console.log(a);d._showErrorMsg(a)}))}},getInfoByAccount:function(a){if(!a)return null;var b=null;_.each(this.ssoController.getServerHistories(rConfig.ACCOUNT_TYPE.UC),function(c){c.account==a&&(b=c)});return b},
retakeMethod:function(a){(a=$(a.target).attr("data-retake"))&&this.showRetakePageByTab(a)},showRetakePageByTab:function(a){this.tabType=a;_.each(this.local.tabs,function(b){b!==a&&($("#"+b).addClass("ms-none"),$("."+b).parent().removeClass("on"))});$("#"+a).removeClass("ms-none");$("."+a).parent().addClass("on")},checkedNeedResetPassword:function(){var a=$("#needResetPassword");"checked"===a.attr("data-checked")?(a.attr("data-checked",""),a.removeClass("cbbg")):(a.attr("data-checked","checked"),a.addClass("cbbg"))},
toAppealRetake:function(){this.tabType="appealRetake";sdk.Url.location.route("#!findPassword/passwordRetake/appealRetake")},retakeAccount:function(a){if($(a.target).hasClass("ac-item")){var b=$(a.target).attr("data-account");$(a.target).attr("data-password");sdk.Url.location.route("#!sso/login/"+b)}},returnGame:function(){var a=$("#newPassword").val(),b=$("#resetPassAccount").attr("data-value");sdk.PageCache.set("auto_login_info",{account:b,password:a});S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,
{override:!1});sdk.Url.location.route("#!sso/login/"+b);this.generalController.clearHistory()},_showErrorMsg:function(a){this.generalController.sendClientMsg(a);},flushInpt:function(a){_.isEmpty($(a.target).val())&&$(a.target).val("");!_.isUndefined(this.noticeBar)&&!_.isEmpty(this.noticeBar)&&sdk.common.ui.NoticeBox.hide(this.noticeBar,null,"slide")}});S.SSVW.Register=Backbone.View.extend({el:"#userContainer",events:{"onclick #newPassword":"flushInpt","onclick #regReturnGameBtn":"returnGame","onclick #modifyPassBtn":"modifyPassword","onclick #modifyPassMask":"closeModifyPassword","onclick #cancelModifyBtn":"closeModifyPassword","onclick #doModifyBtn":"doModifyPassword","onclick #regBindBtn":"gotoBind","onclick #agreementBtn":"gotoAgreement"},isOpenModifyWindow:!1,initialize:function(){_.bindAll(this);this.controller=S.SSCT.GetHandler("Controller",
"User");this.generalController=S.SSCT.GetHandler("Controller","General");this.ssoController=S.SSCT.GetHandler("Controller","Sso")},regSuccess:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["registerSuccess"]});var a=this;this.controller.getRegData(this.controller.callBackMix(function(b){a.ssoController.updateLoginCount(b.ucid);var c=a.generalController.getCacheData("user_info_"+b.ucid);c&&!1===c.random&&$("#passwordName").html("\u5bc6\u7801:");
$("#regTitle").html("\u6210\u529f\u6ce8\u518cUC\u8d26\u53f7");$("#regMsg1").html("UC\u8d26\u53f7\uff1a"+b.ucid);$("#regUcAccount").attr("data-account",b.ucid).html(b.ucid);$("#regPassword").attr("data-password",b.password).html(b.password)},function(){sdk.Url.back()}))},modifyPassword:function(){function a(){var a=parseInt($(window).height()),c=parseInt($(document).height());return a>c?a:c}$("#newPassword").val("");$("#modifyPassMask").height(a());$(window).on("resize",function(){$("#modifyPassMask").height(a())});
this.hideFeedBack();$("#modifyPassWin").removeClass("ms-none");this.isOpenModifyWindow=!0;S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0});document.addEventListener("backbutton",this.closeModifyPassword)},closeModifyPassword:function(){this.isOpenModifyWindow&&($("#modifyPassWin").addClass("ms-none"),$(".btnClick-none").removeClass("btnClick-none"),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),document.removeEventListener("backbutton",
this.closeModifyPassword),$(window).off("resize"))},doModifyPassword:function(){var a=$("#newPassword").val(),b=this;this.controller.registerUpdatePass({isPostPass:!0,oldPassword:$("#regPassword").html(),password:a},this.controller.callBackMix(function(){b.generalController.sendClientMsg("\u4fee\u6539\u6210\u529f");$("#passwordName").html("\u5bc6\u7801:");$("#regPassword").html(a);b.closeModifyPassword()},function(a){b.generalController.sendClientMsg(a)}))},returnGame:function(){var a=this;this.controller.getRegData(this.controller.callBackMix(function(b){var c=
ucf.Cache.get("openTestGame_"+b.ucid,!0),b=ucf.Cache.get("isAlpha_"+b.ucid,!0);console.log(c);!_.isUndefined(c)&&!_.isEmpty(c)&&"B"==c.status?sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(c.message)):b?sdk.Url.redirect("../game/game.html#!game/validCode/false"):a.controller.sdkExit()},function(){sdk.Url.back()}))},gotoBind:function(){S.Url.location.route("#!secrecy/preBind/secrecy")},gotoAgreement:function(){S.Url.location.route("#!user/agreement")},flushInpt:function(a){_.isEmpty($(a.target).val())&&
$(a.target).val("")},_showLoading:function(){return S.common.ui.NoticeBox.loading()},_hideLoading:function(a){S.common.ui.NoticeBox.hide(a,null,"remove")},hideFeedBack:function(){$("input").addClass("btnClick-none")}});S.SSVW.Secrecy=Backbone.View.extend({el:"#userContainer",controller:null,config:{btnLockTime:59,questionList:"\u6211\u66fe\u5c31\u8bfb\u7684\u5c0f\u5b66\u6821\u540d\uff1f,\u523b\u9aa8\u94ed\u5fc3\u76846\u4f4d\u6570\u5b57\uff1f,\u6211\u7684\u5fc3\u613f\u662f\uff1f,\u6211\u7684\u7231\u597d\u662f\uff1f,\u6700\u96be\u5fd8\u90a3\u5e74\u90a3\u6708\u90a3\u65e5\uff1f,\u6700\u559c\u6b22\u7684\u4e00\u53e5\u8bdd\u662f\uff1f,\u6211\u6700\u5173\u6ce8\u7684\u662f\u4ec0\u4e48\uff1f,\u6700\u60f3\u8981\u7684\u7269\u54c1\u540d\u79f0\uff1f".split(",")},
events:{"onclick #mobile, #validCode, #bindPass":"_flushInpt","onclick #toBindPageBtn":"toBindPage","onclick #doBindBtn":"doBind","onclick #resendBtn":"reSendMsg","onclick #cancelIbbBtn":"cancelIbb","onclick #keepBindBtn":"keepBind","onclick #toGameBtn":"doBindSuccess","onclick #toSetQuestionsBtn":"toSetQuestions","change  #questionList":"selQuestion","onclick #saveSecurityBtn":"saveSecurityQuestions"},initialize:function(){_.bindAll(this);this.controller=this.controller?this.controller:S.SSCT.GetHandler("Controller",
"AccountManage");this.generalController=S.SSCT.GetHandler("Controller","General")},toBindPage:function(){this.hideFeedBack("#toBindPageBtn");var a={mobile:$("#mobile").val()},b=this._showLoading(),c=this;this.controller.checkIsBinded(a,this.controller.callBackMix(function(a){c._hideLoading(b);S.SSCT.GetHandler("Controller","General").setCacheData("mobile",$("#mobile").val(),10800,!0);null!==a.ucid?(c.beforeBoxShowed(),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}),
document.addEventListener("backbutton",function(){c.cancelIbb()}),$("#isBindBox")[0].style.display="block"):c.setRouteType("#!secrecy/bind")},function(a){c._hideLoading(b);c._showErrorMsg(a);console.log("checkIsBinded error : "+a)}))},doBind:function(){this.hideFeedBack("#doBindBtn");var a={code:$("#validCode").val(),password:$("#bindPass").val()},b=this._showLoading(),c=this;this.controller.doBindMobile(a,this.controller.callBackMix(function(){c._hideLoading(b);c.beforeBoxShowed();var a=S.SSCT.GetHandler("Controller",
"General"),e=c.getUserInfo().ucid,a=a.getCacheData("mobile",!0);$("#bindSuccessBox").html("<p>UC\u8d26\u53f7:<em>"+e+"</em></p><p>\u624b\u673a\u53f7:<em>"+a+"</em></p><p>\u5df2\u6210\u529f\u7ed1\u5b9a</p>");"user"===c.enterType&&$("#toGameBtn").html("\u5b8c\u6210");$("#toGameBox")[0].style.display="block"},function(a){c._hideLoading(b);101==a.code&&$("#bindPass").val("");c._showErrorMsg(a.msg)}))},reSendMsg:function(){$("#resendBtn").hasClass("clickAble")&&this.sendMsg()},cancelIbb:function(){S.sdkBase.request(S.sdkBase.servType.APP,
S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1});sdk.EC.showInput();this.hideFeedBack("#cancelIbbBtn");var a=this;setTimeout(function(){a.addFeedBack("#cancelIbbBtn")},500);this.addFeedBack("#toBindPageBtn");$("#isBindBox")[0].style.display="none"},keepBind:function(){this.cancelIbb();S.SSCT.GetHandler("Controller","General");this.setRouteType("#!secrecy/bind")},doBindSuccess:function(){this.hideFeedBack("#toGameBtn");var a=this;setTimeout(function(){a.addFeedBack("#toGameBtn")},500);this.addFeedBack("#doBindBtn");
this.cancelTgb();"user"===this.enterType?(S.Url.location.route("#!user"),this.generalController.clearHistory()):this.toGame()},toSetQuestions:function(){this.setRouteType("#!secrecy/securityQuestions")},selQuestion:function(){var a=document.querySelector("#questionList"),a=a.options[a.selectedIndex].value;"-1"==a||""==a||("0"==a?$("#passwordQuestion").val(""):$("#passwordQuestion").val(a))},saveSecurityQuestions:function(){this.hideFeedBack("#saveSecurityBtn");var a={password_question:$("#passwordQuestion").val(),
password_answer:$("#passwordAnswer").val(),password:$("#questionPass").val()},b=this._showLoading(),c=this;this.controller.doSaveSecurityQuestions(a,this.controller.callBackMix(function(){c._hideLoading(b);c.beforeBoxShowed();var a=c.getUserInfo().ucid;$("#saveSuccessBox").html("<p>UC\u8d26\u53f7:<em>"+a+"</em></p><p>\u6210\u529f\u8bbe\u7f6e\u5bc6\u4fdd\u95ee\u9898</p>");"user"===c.enterType&&$("#toGameBtn").val("\u5b8c\u6210");$("#toGameBox")[0].style.display="block"},function(a){c._hideLoading(b);
101==a.code&&$("#questionPass").val("");c._showErrorMsg(a.msg)}))},initBackBtnEvent:function(){var a=this;S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"});S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(b){"sdBackGame"==b.action&&a.toGame()}})},toGame:function(){var a=this.getUserInfo().ucid,b=ucf.Cache.get("openTestGame_"+a,!0),a=ucf.Cache.get("isAlpha_"+a,!0);_.isUndefined(b)||_.isUndefined(a)?
(console.log("get openTestGame isAlpha Error"),this._showErrorMsg("\u7cfb\u7edf\u5f02\u5e38\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5")):b&&b.status&&"B"==b.status?sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(b.message)):a?sdk.Url.redirect("../game/game.html#!game/validCode/false"):S.SSCT.GetHandler("Controller","User").sdkExit()},preBind:function(a){this.enterType=a;S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["preBind"]});
!_.isUndefined($("#mobile").val())&&""!=$("#mobile").val()&&$("#mobile").val("");this.initBackBtnEvent()},bind:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["bind"]});var a=S.SSCT.GetHandler("Controller","General").getCacheData("mobile",!0),b=this.getUserInfo().ucid;!_.isUndefined($("#validCode").val())&&""!=$("#validCode").val()&&$("#validCode").val("");!_.isUndefined($("#bindPass").val())&&""!=$("#bindPass").val()&&$("#bindPass").val("");
if(this.getUserInfo().isRandomPassword)$("#bindPass").val(this.getUserInfo().randomPassword);else{var c=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+b,!0);c&&c.random&&$("#bindPass").val(c.password)}$("#bindInfo").html('<p><span class="bw_name">UC\u8d26\u53f7:</span><em> '+b+'</em></p><p><span class="bw_name">\u9700\u7ed1\u5b9a\u624b\u673a:</span><em> '+a+"</em></p>");this.initBackBtnEvent();this.sendMsg()},securityQuestions:function(a){this.enterType=a;a=this.getUserInfo().ucid;
$("#uc_account").html("UC\u8d26\u53f7\uff1a<em>"+a+"</em>");this.initQuestionList();$("#passwordQuestion").val(this.config.questionList[0]);!_.isUndefined($("#passwordAnswer").val())&&""!=$("#passwordAnswer").val()&&$("#passwordAnswer").val("");this.getUserInfo().isRandomPassword?$("#questionPass").val(this.getUserInfo().randomPassword):(a=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+a,!0))&&a.random&&$("#questionPass").val(a.password);this.initBackBtnEvent()},sendMsg:function(){this.btnCountDown();
var a=this;this.controller.sendCode2Mobile({mobile:S.SSCT.GetHandler("Controller","General").getCacheData("mobile",!0)},this.controller.callBackMix(null,function(b){a.cancelBtnCountDown();a._showErrorMsg("\u53d1\u9001\u9a8c\u8bc1\u7801\u5931\u8d25: "+b)}))},cancelTgb:function(){sdk.EC.showInput();$("#toGameBox")[0].style.display="none"},btnCountDown:function(){"undefined"!=typeof secrecyTimeId&&null!=secrecyTimeId&&(clearInterval(secrecyTimeId),secrecyTimeId=null);var a=this.config.btnLockTime,b=
this;$("#resendBtn").val(a+" \u91cd\u65b0\u83b7\u53d6");$("#resendBtn").removeClass("clickAble");secrecyTimeId=setInterval(function(){0>--a?b.cancelBtnCountDown():$("#resendBtn").val(a+" \u91cd\u65b0\u83b7\u53d6")},1E3)},cancelBtnCountDown:function(){clearInterval(secrecyTimeId);secrecyTimeId=null;$("#resendBtn").val("\u91cd\u65b0\u83b7\u53d6");$("#resendBtn").addClass("clickAble")},_flushInpt:function(a){_.isEmpty($(a.target).val())&&$(a.target).val("");this._hideErrorMsg()},getUserInfo:function(){var a=
a?a:S.SSCT.GetHandler("Controller","User"),b=this,c=a.getCurUser();(_.isEmpty(c)||c=={})&&a.getCurUserInfo(a.callBackMix(function(a){c=a},function(){b._showErrorMsg("\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u9996\u8d25")}));return c},initQuestionList:function(){var a='<option value="-1">\u8bf7\u9009\u62e9\u5bc6\u4fdd\u95ee\u9898</option>';this.config.questionList.map(function(b){a+="<option value="+b+">"+b+"</option>"});a+='<option value="0">\u81ea\u5b9a\u4e49\u95ee\u9898</option>';$("#questionList").html(a)},
beforeBoxShowed:function(){$("#modifyPassMask").height($(window).height()+100);$(window).on("resize",function(){$("#modifyPassMask").height($(window).height()+100)});_.delay(function(){sdk.EC.hideInput()},50)},setRouteType:function(a){var b="secrecy";"user"===this.enterType?b="user":"public"===this.enterType&&(b="public");S.Url.location.route(a+"/"+b)},_showErrorMsg:function(a){S.SSCT.GetHandler("Controller","General").sendClientMsg(a)},_hideErrorMsg:function(a){a=!_.isUndefined(a)&&!_.isEmpty(a)?
a:"slide";!_.isUndefined(this.noticeBar)&&!_.isEmpty(this.noticeBar)&&("remove"==a?S.common.ui.NoticeBox.hide(this.noticeBar,null,"remove"):S.common.ui.NoticeBox.hide(this.noticeBar,null,"slide"))},_showLoading:function(){return S.common.ui.NoticeBox.loading()},_hideLoading:function(a){S.common.ui.NoticeBox.hide(a,null,"remove")},hideFeedBack:function(a){$(a).addClass("btnClick-none")},addFeedBack:function(a){$(a).removeClass("btnClick-none")}});S.SSVW.Sso=Backbone.View.extend({el:"#userContainer",events:{"onclick #username,#password":"_flushInpt","onclick #newPassword":"_flushInpt","onclick #loginBut":"loginSubmit","onclick #registerBut":"register","onclick #forgetPassBtn":"forgetPassword","onclick #mobileBindingBtn":"bindMobile","onclick #returnGameBtn":"returnGame","onclick #gameLoginBtn":"gotoGameLogin","onclick #backBtn":"goBack","onclick #modifyAndLoginBtn":"modifyAndLogin","onclick #useUCAccountLogin":"useUCAccountLogin","onclick #isNerverNotice":"checkNerverNotice",
"change #loginHistory":"selectHis","onclick #updatePassBtn":"_setUpdatePassParam","onclick #cancelLogin":"cancelUCAccountLogin","onclick #neverUpdateBtn":"neverUpdatePass","onclick #cancelModify":"cancelModify","onclick #agreementBtn":"gotoAgreement"},showHistoryFlag:!1,accountType:0,historyScroll:null,localConfig:{HISTORY_LIST_MAX_SIZE:10,LOGIN_COUNT:5},initialize:function(){_.bindAll(this);this.controller=S.SSCT.GetHandler("Controller","Sso");this.userController=S.SSCT.GetHandler("Controller","User");
this.generalController=S.SSCT.GetHandler("Controller","General");this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.LOGIN},login:function(a){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["sso"]});var b=sdk.PageCache.get("auto_login_info");sdk.PageCache.del("auto_login_info");this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.LOGIN;this.controller.clearHistFlag();var c=this.controller.getLoginConfig(),d=c.allowGameLogin,c=c.gameAccountTitle,
c=_.isUndefined(c)||null===c||0===c.length?rConfig.user.defaultGameName:c;$("#gameLoginBtn").html(c+"\u8001\u8d26\u53f7\u767b\u5f55");!0===d&&$("#gameLoginBtn").removeClass("ms-none");b&&b.success&&b.data?this._setHistory(b.data.account,b.data.password):a?this._setHistory(a):this._setHistory();$("#username").attr("placeholder","UC\u8d26\u53f7\\\u624b\u673a");$("#registerBut").val("\u4e00\u952e\u6ce8\u518c");$("#forgetPassBtn").removeClass("ms-ni");$("#gameLoginBottom").addClass("ms-ni");$("#normalLoginBottom").removeClass("ms-ni")},
gameLogin:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["oldAccountLogin"]});var a=this.controller.getLoginConfig().gameAccountTitle,a=_.isUndefined(a)||null===a||0===a.length?rConfig.user.defaultGameName:a;this.setUsername("");this.setPassword("");this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN;$("#loginTitleTabs").html('<a class="item">'+a+'\u8001\u8d26\u53f7</a><p class="btnBox"><a href="javascript:;" id="backBtn" class="fl btn btn_dark back_btn">UC\u8d26\u53f7</a></p>');
$("#username").attr("placeholder",a);$("#registerBut").val("\u6ce8\u518cUC\u8d26\u53f7");$("#forgetPassBtn").addClass("ms-ni");this._setHistory();$("#showHistory").removeClass("ms-block").addClass("ms-ni");$("#normalLoginBottom").addClass("ms-ni");$("#gameLoginBottom").removeClass("ms-ni")},loginSubmit:function(){var a=this,b=this.accountType,c=this.$el.find("#username").val(),d=this.$el.find("#password").val();this.controller.validLoginData(c,d,b,this.controller.callBackMix(function(c,d){var g=a._showLoading();
a.controller.loginSubmit({account:c,password:d,accountType:b,rememberPassword:!0},!0,a.controller.callBackMix(function(b,c){$("input").addClass("btnClick-none");a.userController.getCurUserInfo(a.userController.callBackMix(function(b){var c=a.generalController.getCacheData("user_info_"+b.ucid,!0);c&&c.random&&d!=c.password&&a.generalController.setCacheData("user_info_"+b.ucid,{random:!1,password:d},0,!0)}));a._hideLoading(g);a.doLoginSuccess(b,c)},function(b,c){a._hideLoading(g);a._showErrorMsg(c.msg)}))},
function(b){a._showErrorMsg(b)}))},doLoginSuccess:function(a){var b=a.get("account"),c=a.get("password"),d=a.get("accountType");a.get("rememberPassword");var e=this;ucf.Cache.set("openTestGame_"+a.get("ucid"),a.get("openTestGame"),86400,!0);ucf.Cache.set("isAlpha_"+a.get("ucid"),a.get("isAlpha"),86400,!0);var f={};this.userController.getCurUserInfo(this.userController.callBackMix(function(a){f=a},function(){e.userController.sdkExit()}));if(a=this.generalController.getCacheData("user_info_"+f.ucid,
!0))f.isRandomPassword=a.random,f.randomPassword=f.isRandomPassword?a.password:f.randomPassword;var a=!(!1===f.isRandomPassword||0===f.randomPassword.length),g=ucf.Cache.get("login_binding_info",!0)||{};if(d===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN&&!0!==g[b]){g[b]=!0;ucf.Cache.set("login_binding_info",g,0,!0);var h=f.ucid,j=f.randomPassword;if(a){var i=e._showLoading();this.controller.validSecrecy(d,b,this.controller.callBackMix(function(){e._hideLoading(i);sdk.PageCache.set("login_param",
{accountType:e.controller.CONFIG.ACCOUNT_TYPE.LOGIN,account:h,password:c,randomPassword:j});S.Url.location.route("#!sso/firstGameLogin")},function(){e._hideLoading(i);e.userController.checkNoticeInfo(f.ucid,"updatePassword")?e.doLoginCheck(d,b):e._showUpdateRandomPassBox({accountType:e.controller.CONFIG.ACCOUNT_TYPE.LOGIN,account:f.ucid,randomPassword:f.randomPassword})}))}else this.existUCAccount()}else d===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN?this.existUCAccount(d,f.ucid):d===this.controller.CONFIG.ACCOUNT_TYPE.LOGIN&&
!0===f.isRandomPassword?(this.controller.updateLoginCount(f.ucid),e.userController.checkNoticeInfo(f.ucid,"updatePassword")?e.doLoginCheck(d,b):e._showUpdateRandomPassBox({accountType:d,account:f.ucid,randomPassword:f.randomPassword,isUCLogin:!0})):(this.controller.updateLoginCount(f.ucid),this.doLoginCheck(d,f.ucid))},register:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["register"]});var a=this._randomPassword(),b=this._showLoading(),
c=this;this.userController.register({password:a,isAutoLogin:!0,agree:!0},this.userController.callBackMix(function(d){c.generalController.setCacheData("user_info_"+d.get("ucid"),{random:!0,password:a},0,!0);d={account:d.get("ucid"),password:a};c.controller.loginSubmit(d,!0,c.controller.callBackMix(function(a){c._hideLoading(b);ucf.Cache.set("openTestGame_"+a.get("ucid"),a.get("openTestGame"),3600,!0);ucf.Cache.set("isAlpha_"+a.get("ucid"),a.get("isAlpha"),3600,!0);S.Url.location.route("#!register/regSuccess")},
function(){c._hideLoading(b);c._showErrorMsg("\u767b\u9646\u5931\u8d25")}))},_.bind(function(a){c._hideLoading(b);c.generalController.sendClientMsg(a)},this)),!0)},doLoginCheck:function(a,b,c){function d(){!_.isUndefined(g)&&!_.isEmpty(g)&&"B"==g.status?sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(g.message)):h?sdk.Url.redirect("../game/game.html#!game/validCode/false"):c?c.apply(e):e.userController.sdkExit()}var e=this,f=this.userController.getCurUser().ucid,g=ucf.Cache.get("openTestGame_"+
f,!0),h=ucf.Cache.get("isAlpha_"+f,!0),f=this.controller.getLoginCount(f);a==this.controller.CONFIG.ACCOUNT_TYPE.LOGIN&&f==this.localConfig.LOGIN_COUNT?this.toSecrecyPage(a,b,function(){d()}):d()},bindMobile:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["bindSecrecyMobile"]);sdk.Url.location.route("#!secrecy/preBind/secrecy")},returnGame:function(){var a=$("#ucAccount").attr("data-value");this.doLoginCheck($("#ucAccount").attr("data-acType"),a)},firstGameLogin:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,
{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["firstGameLogin"]});var a=sdk.PageCache.get("login_param");if(a.success&&a.data){var b=a.data.account,c=a.data.accountType,a=a.data.randomPassword;$("#ucAccount").html(b);$("#ucAccount").attr("data-value",b);$("#ucAccount").attr("data-acType",c);$("#randomPassword").attr("data-value",a);$("#randomPassword").html(a)}},modifyAndLogin:function(){var a=this,b=$("#newPassword").val(),c=$("#accountParam").attr("data-value"),d=$("#accountParam").attr("data-acType"),
e=$("#accountParam").attr("data-password"),f="callback"===$("#modifyAndLoginBtn").attr("data-callback")?!0:!1;S.SSCT.GetHandler("Controller","User").updatePass({oldPassword:e,password:b,isPostPass:!0},S.SSCT.GetHandler("Controller","User").callBackMix(function(){var e;f&&(e=function(){$("#passwordLabel").html("\u5bc6\u7801");$("#randomPassword").html(b);$("#randomPassword").attr("data-value",b);a._hidePopBox()});a.doLoginCheck(d,c,e)},function(b){a._showErrorMsg(b,"#loginSuccessNoticeBox")}))},existUCAccount:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,
{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["existUCAccount"]});this._showExsitAccountBox()},toSecrecyPage:function(a,b,c){var d=this,e=this._showLoading();this.controller.validSecrecy(a,b,this.controller.callBackMix(function(){d._hideLoading(e);sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["bindSecrecyMobile"]);sdk.Url.location.route("#!secrecy/preBind/secrecy")},function(){d._hideLoading(e);c()}))},checkNerverNotice:function(){var a=$("#isNerverNotice");"checked"===a.attr("data-value")?
(a.attr("data-value",""),a.removeClass("cbbg")):(a.attr("data-value","checked"),a.addClass("cbbg"))},useUCAccountLogin:function(){var a=this.userController.getCurUser(),b=this.generalController.getCacheData("user_info_"+a.ucid,!0);if(b)a.isRandomPassword=b.random,a.randomPassword=a.isRandomPassword?b.password:a.randomPassword;!(!1===a.isRandomPassword||0===a.randomPassword.length)?this.userController.checkNoticeInfo(a.ucid,"updatePassword")?this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,
a.ucid):this._showUpdateRandomPassBox({accountType:this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,account:a.ucid,randomPassword:a.randomPassword}):this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,a.ucid)},setUsername:function(a){this.$el.find("#username").val(a)},setPassword:function(a){this.$el.find("#password").val(a)},selectHis:function(){var a=document.querySelector("#loginHistory"),a=a.options[a.selectedIndex].value||$("#loginHistory").val();if("-1"!=a){var b={};this.controller.getHistByUsername(a,
this.accountType,this.controller.callBackMix(function(a){b=a}));this._setAccount({account:b.account,password:b.password,isRandomPassword:b.isRandomPassword})}},checkRememPassword:function(a){var a=a.target,b;"checked"===a.getAttribute("data-checked")?(b="",$(a).removeClass(this.localConfig.checkedClass)):(b="checked",$(a).addClass(this.localConfig.checkedClass));a.setAttribute("data-checked",b)},resetUsername:function(){this.setUsername("");this.resetPassword()},resetPassword:function(){this.setPassword("")},
cancelUCAccountLogin:function(){var a=this.userController.getCurUser();this.userController.setNerverNotice(a.ucid,!0);this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,a.ucid)},neverUpdatePass:function(){var a=this.userController.getCurUser();this.userController.setNerverNotice(a.ucid,!0,"updatePassword");$(".btnClick-none").removeClass("btnClick-none");this._hidePopBox();this.doLoginCheck(this.accountType,a.ucid)},cancelModify:function(){this._hidePopBox()},forgetPassword:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,
["forgetPassword"]);S.Url.location.route("#!findPassword/passwordRetake/messageRetake")},gotoAgreement:function(){S.Url.location.route("#!user/agreement")},gotoGameLogin:function(){S.Url.location.route("#!sso/gameLogin")},goBack:function(){S.Url.back()},_setHistory:function(a,b){var c=!1,d="",e="";this._getHistData(_.bind(function(f){var g=this.controller.getHistLength(this.accountType);if(0!==g&&!_.isUndefined(f[0])){1<g?this.$el.find("#showHistory").removeClass("ms-ni").addClass("ms-block"):this.$el.find("#showHistory").removeClass("ms-block").addClass("ms-ni");
var h=null;$("#loginHistory").html('<option value="-1">\u8bf7\u9009\u62e9\u8d26\u53f7</option>');_.each(f,function(b){!_.isEmpty(a)&&b.account===a&&(h=b);$("#loginHistory").append('<option value="'+b.account+'">'+b.account+"</option>")});a&&b?h={isRandomPassword:!1,account:a,rememberPassword:!0,password:b}:a&&null===h?h={isRandomPassword:!1,account:a,rememberPassword:!1,password:""}:null===h&&(h=f[0]);c=h.isRandomPassword;d=h.account;if(h.rememberPassword)e=h.password}else this.$el.find("#showHistory").removeClass("ms-block").addClass("ms-ni");
this._setAccount({account:d,password:e,isRandomPassword:c})},this),!0)},_flushInpt:function(a){_.isEmpty($(a.target).val())&&$(a.target).val("");$(window).width();$(window).height()},_setAccount:function(a){this.setUsername(a.account);this.setPassword(a.password)},_showLoading:function(){return S.common.ui.NoticeBox.loading()},_hideLoading:function(a){S.common.ui.NoticeBox.hide(a,null,"remove")},_getHistData:function(a,b){var c=this,d=this.controller.getHistories(this.accountType);_.isUndefined(d)||
!0===b?this.controller.getHistory(this.accountType,this.controller.callBackMix(function(b){a&&a(b)},function(a){c._showErrorMsg(a,"#errorEl")})):a&&a(d)},_showUpdateRandomPassBox:function(a){$("input").addClass("btnClick-none");this._showPopBox(template.render("updateRandomPassBoxTempl"),function(){$("#accountParam").attr("data-value",a.account);$("#accountParam").attr("data-acType",a.accountType);$("#accountParam").attr("data-password",a.randomPassword)})},_setUpdatePassParam:function(){$("input").addClass("btnClick-none");
var a=$("#ucAccount").attr("data-value"),b=$("#ucAccount").attr("data-acType"),c=$("#randomPassword").attr("data-value");this._showUpdatePassBox({account:a,accountType:b,password:c})},_showUpdatePassBox:function(a){this._showPopBox(template.render("updatePassBoxTempl"),function(){$("#accountParam").html(a.account);$("#accountParam").attr("data-value",a.account);$("#accountParam").attr("data-acType",a.accountType);$("#accountParam").attr("data-password",a.password)})},_showExsitAccountBox:function(){var a=
this.userController.getCurUser();this.userController.checkNoticeInfo(a.ucid)?this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,a.ucid):this._showPopBox(template.render("ownUCAccountBoxTempl"),function(){$("#bindTitle").html("\u6211\u4eec\u53d1\u73b0\u4f60\u7684\u300a"+a.gameName+"\u300b\u6e38\u620f\u8001\u8d26\u53f7\u548cUC\u8d26\u53f7\u66fe\u7ecf\u7ed1\u5b9a\u8fc7\u3002");$("#bindUcid").html("UC\u8d26\u53f7\uff1a"+a.ucid)})},_showPopBox:function(a,b){var c=this;_.delay(function(){function d(){var a=
parseInt($(window).height()),b=parseInt($(document).height());return a>b?a:b}sdk.EC.hideInput();$("#popBox").html(a);$("#popup").removeClass("ms-none");$("#modifyPassMask").height(d());$(window).on("resize",function(){$("#modifyPassMask").height(d())});S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0});document.addEventListener("backbutton",function(){c._hidePopBox()});b.apply(c)},50)},_hidePopBox:function(){sdk.EC.showInput();$("#popup").addClass("ms-none");
$(".btnClick-none").removeClass("btnClick-none");$(window).off("resize");S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1});document.removeEventListener("backbutton")},_showErrorMsg:function(a){this.generalController.sendClientMsg(a)},_randomPassword:function(){return Math.random().toString().substr(2,8)}});S.SSVW.User=Backbone.View.extend({el:"#userContainer",events:{"onclick #oldPass,#newPass":"flushInpt","onclick #changePassBtn":"gotoUpdatePass","onclick #confirmChangePass":"doUpdatePass","onclick #payHistoryBtn":"gotoPayHistory","onclick #logoutBtn":"logout","onclick #aboutBtn":"gotoAboutUs","onclick #feedBackBtn":"gotoFeedBack","onclick #bbsBtn":"gotoBBS","onclick #existAccountBtn":"gotoLogin","onclick #gameExp":"gotoGameExp","onclick #vipBtn":"gotoVipArea","onclick #toSecrecyBtn":"gotoSecrecy",
"onclick #changeNickname":"changeNickname","onclick #submitNicknameBtn":"submitNickname","onclick #accountSecureBtn":"gotoAccountSecure","onclick #rechargeBtn":"gotoRecharge","onclick #multiAccountBtn":"gotoMultiAccount","onclick #becomeVipBtn":"gotoBecomeVip","onclick .del_icon":"_showConfirmBox","onclick #exitBtn":"curLogout"},pageScroll:{},initialize:function(){_.bindAll(this);this.controller=S.SSCT.GetHandler("Controller","User");this.ssoController=S.SSCT.GetHandler("Controller","Sso");this.generalController=
S.SSCT.GetHandler("Controller","General")},userInfo:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["management"]});this._userInfo();this.entranceControl();this.controller.getBaseUserInfo(this.controller.callBackMix(this.renderBaseInfo,$.proxy(function(a){this.renderBaseInfo({});sdk.common.ui.NoticeBox.error(a)},this)))},updatePassword:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,
enterBusiness:["updatePassword"]});this._userInfo();var a=this.controller.getCurUser(),b=this.controller.userName,c=ucf.Cache.get("userBaseInfo_"+a.ucid,!0),b=_.isUndefined(c)||_.isEmpty(c)?_.isUndefined(b)||_.isEmpty(b)?"UC\u7528\u6237":b:c.userName.length>rConfig.user.showUserNickLen?c.userName.substr(0,rConfig.user.showUserNickLen-1)+"...":c.userName;this.$el.find("#up-nickname").html(b);this.$el.find("#up-ucid").html("("+a.ucid+")");this.$el.find("#newPass").val("");this.$el.find("#newPass").attr("placeholder",
"\u8bf7\u8f93\u51656-20\u4f4d\u5b57\u6bcd\u6216\u6570\u5b57");b=this.generalController.getCacheData("user_info_"+a.ucid,!0);if(!_.isUndefined(b)&&!_.isEmpty(b)&&b.random)a.isRandomPassword=!0,a.randomPassword=b.password;a.isRandomPassword?(this.$el.find("#oldPass").attr("placeholder",""),this.$el.find("#oldPass").val(a.randomPassword)):(this.$el.find("#oldPass").val(""),this.$el.find("#oldPass").attr("placeholder","\u8bf7\u8f93\u51656-20\u4f4d\u5b57\u6bcd\u6216\u6570\u5b57"));var d=this;S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,
{eventName:"bridgeTopBtnClicked"});S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(a){"onEdit"==a.action&&!0===d.editMode?d.cancelEditMode():"doUpdatePass"==a.action&&!0!==d.editMode&&d.doUpdatePass()}})},renderBaseInfo:function(a){var b=this,c=S.SSCT.GetHandler("Controller","AccountManage");c.getSecureState(c.callBackMix(function(a){var b=$("#secureState");b.data("risk",a.risk);3<=a.risk?(b.text("\u7ea7\u522b\uff1a\u4f4e"),b.removeClass(),
b.addClass("oth pag_red")):(b.text("\u7ea7\u522b\uff1a\u9ad8"),b.removeClass(),b.addClass("oth pag_green"))},function(a){b._showErrorMsg(a)}));c=S.SSCT.GetHandler("Controller","Pay");c.getUPointBalance(c.callBackMix(function(a){$("#uPointBalance").text("\u4f59\u989d"+a.get("balance"))},function(a){b._showErrorMsg(a)}));c=S.SSCT.GetHandler("Controller","User");c.getLoginHistoryCount({},c.callBackMix(function(a){$("#accountNo").addClass("pag_blue");99<parseInt(a.count)?$("#accountNo").text("N"):$("#accountNo").text(a.count)},
function(a){b._showErrorMsg(a)}));this.$el.find("#userInfoDetailBtn").removeAttr("disabled");this.controller.getCurUserInfo();var c=this.controller.getCurUser(),d=a.userName,e;_.isUndefined(d)||_.isEmpty(d)?d="UC\u7528\u6237":d.length>rConfig.user.showUserNickLen&&(d=d.substr(0,rConfig.user.showUserNickLen-1)+"...");e=_.isUndefined(a.level)?0:a.level;_.isEmpty(a)?(ucf.Cache.set("userBaseInfo_"+c.ucid,{level:0,userName:"UC\u7528\u6237"},1800,!0),this.$el.find("#userInfoNickname").html(d),this.$el.find("#userInfoUcid").html(c.ucid),
this.$el.find("#userInfoLevel").html(0),this.$el.find("#userInfoAvatar").attr("src","../common/sdk_images/tx-999.jpg"),this.$el.find("#userInfoVip").css("display","none")):(this.$el.find("#userInfoNickname").html(d),this.$el.find("#userInfoUcid").html(c.ucid),genderAvatar=0===a.gender?"../common/sdk_images/tx-998.jpg":"../common/sdk_images/tx-999.jpg",this.$el.find("#userInfoAvatar").attr("src",genderAvatar),this.$el.find("#userInfoLevel").html(e),this.controller.getVipInfo(this.controller.callBackMix(function(){$("#userInfoVip").css("display",
"block")},function(){$("#userInfoVip").css("display","none")})))},entranceControl:function(){var a=!1;this.controller.getFeatureSwitch(this.controller.callBackMix(function(b){b.enablePayHistory&&($("#payHistoryBtn").removeClass("ms-ni"),$("#payHistoryBtn").addClass("p-last-border"),$("#rechargeBtn").removeClass("raddius"),a=!0);b.enableUserChange&&($("#logoutBtn").parent().removeClass("ms-none"),a||($("#logoutBtn").parent().addClass("p-last-border"),a=!0));a&&$("#gameExp").parent().removeClass("p-last-border")}));
this.showVipPanel(a)},doUpdatePass:function(){var a=this.$el.find("#oldPass").val(),b=this.$el.find("#newPass").val();if(a)if(b){this.controller.setCurUser({});this.$el.find("#confirmChangePass").attr("disabled","disabled");var c=this;this.controller.updatePass({oldPassword:a,password:b,isPostPass:!0},this.controller.callBackMix(function(){c.controller.getCurUserInfo(c.controller.callBackMix(function(){$("body").addClass("btnClick-none");c._showErrorMsg("\u66f4\u65b0\u5bc6\u7801\u6210\u529f");S.Url.back()},
function(){S.Url.location.route("#!sso/login")}))},function(a){c._showErrorMsg(a);c.$el.find("#confirmChangePass").removeAttr("disabled")}))}else this._showErrorMsg("\u8bf7\u8f93\u5165\u65b0\u5bc6\u7801");else this._showErrorMsg("\u8bf7\u8f93\u5165\u65e7\u5bc6\u7801")},flushInpt:function(a){_.isEmpty($(a.target).val())&&$(a.target).val("");!_.isUndefined(this.noticeBar)&&!_.isEmpty(this.noticeBar)&&sdk.common.ui.NoticeBox.hide(this.noticeBar,null,"slide")},logout:function(){this.generalController.jumpToNativePage({uiBusiness:"login"})},
_userInfo:function(){var a=this;this.controller.getCurUserInfo(this.controller.callBackMix(null,$.proxy(function(){this.generalController.getSourcePageInfo(this.generalController.callBackMix(function(b){a.generalController.jumpToNativePage(b)},function(){S.Url.location.route("#!sso/login")}))},this)))},showVipPanel:function(a){this.controller.getVipInfo(this.controller.callBackMix(function(){var b=$("#vip");b.css("display","block");a||(b.addClass("p-last-border"),$("#gameExp").parent().removeClass("p-last-border"))},
function(){}))},gotoVipArea:function(){S.Url.location.route("#!vip/showVipArea")},gotoUpdatePass:function(){S.Url.location.route("#!user/updatePassword")},gotoPayHistory:function(){var a=window.location.href.replace("user/user.html#!user","pay/pay.html#!pay/history/"+S.SSCT.GetHandler("Controller","User").getCurUser().gameName);sdk.Log.pageEnter(sdk.Log.businesses.PAGE_PAY,["payHistory"]);S.Url.redirect(eConfig.payHistoryUrl+(0<=eConfig.payHistoryUrl.indexOf("?")?"&":"?")+"p="+encodeURIComponent(a))},
gotoAboutUs:function(){var a=this.controller.getCurUser();sdk.Log.pageEnter(sdk.Log.businesses.PAGE_GENERAL,["about"]);S.Url.redirect("../general/about.html?game="+a.gameName)},gotoLogin:function(){var a=this;this.generalController.getSourcePageInfo(this.generalController.callBackMix(function(b){a.generalController.jumpToNativePage(b)},function(){S.Url.location.route("#!sso")}))},gotoFeedBack:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["feedBack"]);sdk.PageCache.set("feedBack_result_url",
window.location.href);var a=S.SSCT.GetHandler("Controller","Game"),b=this;a.getGameInfo(a.callBackMix(function(a){S.Url.redirect(eConfig.feedBackCenter+"?uid="+b.controller.getCurUser().ucid+"&uname="+b.controller.getCurUser().nickname+"&gid="+a.gameId+"&gname="+b.controller.getCurUser().gameName+"&skey=D02")}))},gotoBBS:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["bbsClick"]);sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["bbsClick"]);sdk.PageCache.set("sdk_redirect_out",1);S.Url.redirect("../bbs/bbs.html")},
gotoGameExp:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["gameExp"]);sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["gameExp"]);S.Url.redirect("http://a.9game.cn/sdk/list.html")},gotoSecrecy:function(){S.Url.location.route("#!secrecy/preBind/user")},multiAccount:function(){var a="",b=this.controller.getCurUser(),c=this;this.editMode=!1;this._getHistData(function(d){_.each(d,function(c){itemHtml=template("accountInfoItemTempl",{gameName:_.isEmpty(c.gameName)?"\u7a7a":c.gameName,ucAccount:c.account,
status:c.account==b.ucid?"icon_st":""});a+=itemHtml});$("#accountInfos").html(a);S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"});S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(a){console.log("back page : "+a.action);"backToUser"==a.action&&(sdk.common.ui.MsgBox.remove(),S.Url.back());"onEdit"==a.action&&!0===c.editMode?c.cancelEditMode():"onEdit"==a.action&&!0!==c.editMode&&c.showEditMode()}})},
!0)},showEditMode:function(){this.editMode=!0;this.generalController.setHeaderStyle({topBarBtnBackGame:{text:"\u53d6\u6d88",visible:!0,visiblePersist:!1,btnShape:"rect"}});$(".delStatus").removeClass("ms-none")},cancelEditMode:function(){this.editMode=!1;this.generalController.setHeaderStyle({topBarBtnBackGame:{text:"\u7f16\u8f91",visible:!0,visiblePersist:!1,btnShape:"rect"}});$(".delStatus").addClass("ms-none")},_getHistData:function(a,b){var c=this,d=rConfig.ACCOUNT_TYPE.UC,e=this.ssoController.getHistories(d);
!e||b?this.ssoController.getHistory(d,this.controller.callBackMix(function(b){a&&a(b)},function(a){c._showErrorMsg(a)})):a&&a(e)},removeHistory:function(a){var b=$(a).attr("data-account"),c=this;this.controller.removeHistory({accountType:rConfig.ACCOUNT_TYPE.UC,account:parseInt(b)},this.controller.callBackMix(function(){ucf.Cache.remove("user_info_"+b,!0);$(a).remove()},function(){console.log("remove error");c._showErrorMsg()}))},_showConfirmBox:function(a){var b=this;if($(a.target).hasClass("del_icon")){$(a.target).addClass("btnClick-none");
var c=a.target.parentNode.parentNode;sdk.common.ui.MsgBox.show('<div><center><p class="gr-f16">\u786e\u8ba4\u5728\u672c\u673a\u5220\u9664\u8d26\u53f7'+$(c).attr("data-account")+"\uff1f</p></center></div><div><center><p>\u88ab\u5220\u9664\u8d26\u53f7\u5c06\u4e0d\u4f1a\u51fa\u73b0\u5728\u767b\u5f55\u8f93\u5165\u6846\u4e2d</p></center></div>",{confirmName:"\u786e\u5b9a",cancelName:"\u53d6\u6d88",callBack:function(){console.log("confirm remove");$(a.target).removeClass("btnClick-none");b.removeHistory(c)},
cancel:function(){console.log("cancel remove");$(a.target).removeClass("btnClick-none");sdk.common.ui.MsgBox.remove()}},"confirm",!0)}},curLogout:function(){var a=this;S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT);this.controller.notifyCp(null,{success:function(){},error:function(){a._showErrorMsg("\u901a\u77e5\u6e38\u620f\u5931\u8d25")}},"logout");sdk.PageCache.set("clear_history",1);this.generalController.jumpToNativePage({uiBusiness:"login"})},_showErrorMsg:function(a){this.generalController.sendClientMsg(a)},
changeNickname:function(){$("#userInfoNickname").toggleClass("hide");$("#changeNickname").toggleClass("hide");$("#editNickname").toggleClass("hide");$("#submitNicknameBtn").toggleClass("hide")},submitNickname:function(){var a=this.$el.find("#editNickname").val();if(a){this.controller.setCurUser({});var a={uid:this.$el.find("#userInfoUcid").text(),userName:a},b=this;console.log("fdsfdsfsdfsdfds");this.controller.updateNickname(a,this.controller.callBackMix(function(){b.controller.getCurUserInfo(b.controller.callBackMix(function(){b._showErrorMsg("\u4fee\u6539\u6635\u79f0\u6210\u529f");
b.changeNickname();var a=$("#editNickname").val();a.length>rConfig.user.showUserNickLen&&(a=a.substr(0,rConfig.user.showUserNickLen-1)+"...");$("#userInfoNickname").text(a)},function(){S.Url.location.route("#!sso/login")}))},function(a){"userName_isExist"==a?b._showErrorMsg("\u7528\u6237\u540d\u5df2\u5b58\u5728"):b._showErrorMsg(a)}))}else this._showErrorMsg("\u8bf7\u8f93\u5165\u6635\u79f0")},gotoAccountSecure:function(){var a=$("#secureState");"\u83b7\u53d6\u4e2d"!=a.text()&&(3<=parseInt(a.data("risk"))?
(sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["accountSecure"]),S.Url.location.route("#!secrecy/preBind/user")):(sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["accountSecure"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["accountSecure"]),sdk.PageCache.set("sdk_redirect_out",1),S.Url.redirect(eConfig.secureUrl+"?uc_param_str=frpfvesscpmilaprnisieiut&appId=17")))},gotoRecharge:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["udPay"]);sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,
["udPay"]);sdk.PageCache.set("sdk_redirect_out",1);var a=eConfig.udPayCenterUrl+"?wp="+encodeURIComponent("H5\u5145\u503c\u9996\u9875")+"&from="+encodeURIComponent("\u6e38\u620fSDK\u4e2a\u4eba\u4e2d\u5fc3")+"&link="+encodeURIComponent("H5\u5145\u503c\u9996\u9875");S.Url.redirect(a)},gotoMultiAccount:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["multiAccount"]);S.Url.location.route("#!user/multiAccount")},gotoBecomeVip:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["becomeVip"]);
sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["becomeVip"]);sdk.PageCache.set("sdk_redirect_out",1);S.Url.redirect(eConfig.becomeVip)}});S.SSVW.Vip=Backbone.View.extend({el:"#userContainer",events:{},initialize:function(){_.bindAll(this,"showVipArea")},showVipArea:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["vip"]})}});
